<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Folder Data Porter</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 40px; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 1000px; margin: auto; }
        .drop-zone { border: 3px dashed #cbd5e0; padding: 40px; text-align: center; border-radius: 10px; cursor: pointer; background: #fafbfc; transition: 0.2s; }
        .drop-zone:hover { border-color: #4a90e2; background: #f0f7ff; }
        .controls { margin-top: 20px; display: flex; gap: 10px; display: none; }
        .btn { padding: 10px 18px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-txt { background: #4a5568; color: white; }
        .btn-csv { background: #38a169; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th, td { border-bottom: 1px solid #e2e8f0; padding: 12px; text-align: left; }
        th { background: #f8fafc; }
        .preview-content { max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #718096; font-family: monospace; }
    </style>
</head>
<body>

<div class="card">
    <h2>ðŸ“‚ Folder Data Inspector</h2>
    <p>Upload a folder to extract file paths, sizes, and text content.</p>

    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
        <strong>Click to select a folder</strong>
        <p>Your files will be processed locally in your browser.</p>
        <input type="file" id="fileInput" webkitdirectory directory multiple style="display:none">
    </div>

    <div class="controls" id="controls">
        <button class="btn btn-txt" onclick="exportTxt()">Export as TXT</button>
        <button class="btn btn-csv" onclick="exportCsv()">Export as Spreadsheet (CSV)</button>
    </div>

    <table id="fileTable" style="display:none;">
        <thead>
            <tr>
                <th>Path</th>
                <th>Size (KB)</th>
                <th>Text Preview</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const table = document.getElementById('fileTable');
    const tableBody = document.getElementById('tableBody');
    const controls = document.getElementById('controls');
    
    let fileData = [];

    fileInput.addEventListener('change', async (e) => {
        const files = Array.from(e.target.files);
        fileData = [];
        tableBody.innerHTML = '';

        for (const file of files) {
            let content = "Non-text file";
            
            // Try to read content if it's a text-based file
            if (file.type.startsWith('text/') || file.name.endsWith('.txt') || file.name.endsWith('.md')) {
                content = await file.text();
            }

            const fileObj = {
                path: file.webkitRelativePath || file.name,
                size: (file.size / 1024).toFixed(2),
                content: content.replace(/[\r\n]+/g, ' ').substring(0, 100) // Clean for preview
            };

            fileData.push({ ...fileObj, fullContent: content });
            renderRow(fileObj);
        }

        table.style.display = 'table';
        controls.style.display = 'flex';
    });

    function renderRow(obj) {
        const row = `<tr>
            <td>${obj.path}</td>
            <td>${obj.size}</td>
            <td class="preview-content">${obj.content}</td>
        </tr>`;
        tableBody.innerHTML += row;
    }

    function exportTxt() {
        let output = "FOLDER EXPORT REPORT\n" + "=".repeat(30) + "\n\n";
        fileData.forEach(f => {
            output += `FILE: ${f.path}\nSIZE: ${f.size} KB\nCONTENT:\n${f.fullContent}\n\n${"-".repeat(20)}\n\n`;
        });
        downloadFile(output, 'folder_report.txt', 'text/plain');
    }

    function exportCsv() {
        let csv = "File Path,Size (KB),Content Preview\n";
        fileData.forEach(f => {
            // Escape quotes for CSV safety
            const safeContent = f.fullContent.replace(/"/g, '""').substring(0, 500);
            csv += `"${f.path}","${f.size}","${safeContent}"\n`;
        });
        downloadFile(csv, 'folder_report.csv', 'text/csv');
    }

    function downloadFile(data, filename, type) {
        const blob = new Blob([data], { type: type });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
    }
</script>

</body>
</html>